on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: self-hosted  # Spécifie ici le runner auto-hébergé
    steps:
      - name: Checkout code
        uses: actions/checkout@v2   

      - name: Display current directory and set environment variable
        run: |
          echo Current directory is: %cd%
          echo CURRENT_DIR=%cd% >> $GITHUB_ENV
        shell: cmd  

      - name: List files in current directory
        run: dir %cd%
        shell: cmd

      - name: Verify IRISimport.scr exists
        run: |
          if exist %cd%\IRISimport.scr (
            echo IRISimport.scr found
          ) else (
            echo IRISimport.scr not found
            exit /b 1
          )
        shell: cmd

      - name: Log and run iristerm script IMPORT
        run: |
          set CURRENT_DIR=%cd%
          set COMMAND="C:\InterSystems\Cache\bin\iristerm.exe /console=cn_iptcp:127.0.0.1[23] %CURRENT_DIR%\IRISimport.scr"
          echo %COMMAND%
          %COMMAND% > output.log 2>&1
          type output.log
        shell: cmd